<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Personel — Terminal Style</title>

<style>
:root{
  --bg:#000;
  --green:#00ff00;
  --green-dim: rgba(0,255,0,0.06);
  --green-line: rgba(0,255,0,0.18);
  --mono: "Courier New", monospace;
}
html,body{
  height:100%;
  margin:0;
  background:var(--bg);
  color:var(--green);
  font-family:var(--mono);
  font-size:13px;
}
.page{ max-width:1100px; margin:15px auto; padding:18px; }

.rahasia-blink{
  color:red; font-weight:bold;
  animation:blink .8s infinite;
}
@keyframes blink{ 0%{opacity:1} 50%{opacity:0} 100%{opacity:1} }

.header{ white-space:pre; margin-bottom:18px; line-height:1.1; }
.meta{ margin-bottom:16px; opacity:0.95; }

.title-bar{
  background:linear-gradient(0deg,rgba(0,40,0,0.95),rgba(0,20,0,0.95));
  padding:6px 10px; border:1px solid var(--green-line);
  margin-bottom:10px; font-weight:700; letter-spacing:.6px;
}

.cols{
  display:grid;
  grid-template-columns:40px 220px 220px 125px 125px 1fr;
  gap:6px; padding:8px 6px; margin-bottom:6px;
  font-size:12px;
}
.cols .col{ padding-left:8px; font-weight:500; letter-spacing:.8px; }

.rows{ position:relative; margin-bottom:18px; }
.row{
  display:grid;
  grid-template-columns:40px 220px 220px 125px 125px 1fr;
  gap:6px; padding:8px 6px;
  border-top:1px solid var(--green-dim);
}
.cell{
  padding-left:8px; background:transparent;
  color:var(--green); outline:none;
  font-family:var(--mono); font-size:12px;
}
.rows::after{
  content:""; position:absolute; right:6px; top:0; bottom:0;
  width:2px; background:linear-gradient(180deg,rgba(0,255,0,0.06),transparent);
}

.controls{ margin:12px 0; }
button{
  background:transparent; color:var(--green);
  border:1px solid var(--green-line); padding:8px 12px;
  font-family:var(--mono); cursor:pointer;
}
button:hover{ background:rgba(0,255,0,0.02); }

.footer{ margin-top:14px; padding-top:10px; border-top:1px dashed var(--green-line); }
.muted{ opacity:0.6; }
.small{ font-size:12px; }

</style>
</head>

<body>
<div class="page">

<div class="header">
FILE: PERSONEL PUSLAT KODIKLATAU | CLASSIFICATION : <span class="rahasia-blink">RAHASIA</span>
================================================================
</div>

<div class="meta muted">PUSLAT</div>

<div class="title-bar small">
  DAFTAR CATATAN PERSONEL — STATUS: UPDATE
</div>

<!-- HEADER TABEL -->
<div class="cols">
  <div class="col">NO</div>
  <div class="col">CATATAN HUKUMAN</div>
  <div class="col">JENIS CATATAN</div>
  <div class="col">TANGGAL MULAI</div>
  <div class="col">TANGGAL KELUAR</div>
  <div class="col">KETERANGAN</div>
</div>

<div class="rows" id="rowsContainer"></div>

<div class="controls">
  <button onclick="tambahBaris(1)">+ Tambah 1 Baris</button>
  <button onclick="simpan()">SIMPAN</button>
  <button onclick="loadData()">Muat Ulang</button>
  <button onclick="history.back()">← KEMBALI</button>
</div>

<div class="footer">
  <div class="muted">Kepala Dinas Personel,</div>
  <div style="height:80px"></div>
  <div class="muted">Endriady, S.H<br>Letkol Adm NRP 522726</div>
</div>

</div>

<script>
// ---------------- CONFIG ----------------
const APP_URL = 
"https://script.google.com/macros/s/AKfycbztqChoA2m81ag7O5dET4wOhyVwmvA94lGNfgQGAK3KtNMwSLLigCYkYfUdEzXdK5Xf/exec";

let nama = new URLSearchParams(location.search).get("nama") || "Andi Darmawan";

// Tambah nama di header
document.querySelector(".header").innerHTML += "\n\nCATATAN: " + nama + "\n\n";

// ---------------- BARIS ----------------
function buatBaris(index, data = {}) {
  const div = document.createElement("div");
  div.className = "row";

  div.innerHTML = `
    <div class="cell" contenteditable="true">${data.no ?? index}</div>
    <div class="cell" contenteditable="true">${data.catatan ?? ""}</div>
    <div class="cell" contenteditable="true">${data.jenis ?? ""}</div>
    <div class="cell" contenteditable="true">${data.mulai ?? ""}</div>
    <div class="cell" contenteditable="true">${data.keluar ?? ""}</div>
    <div class="cell" contenteditable="true">${data.keterangan ?? ""}</div>
  `;

  return div;
}

function renderEmpty(n=1){
  const c = document.getElementById("rowsContainer");
  c.innerHTML="";
  for(let i=1;i<=n;i++) c.appendChild(buatBaris(i));
}

function tambahBaris(n=1){
  const c = document.getElementById("rowsContainer");
  const cur = c.children.length;
  for(let i=1;i<=n;i++) c.appendChild(buatBaris(cur+i));
}

function readRows(){
  const out=[];
  document.querySelectorAll(".row").forEach(r=>{
    const t = r.querySelectorAll(".cell");
    out.push({
      no: t[0].innerText.trim(),
      catatan: t[1].innerText.trim(),
      jenis: t[2].innerText.trim(),
      mulai: t[3].innerText.trim(),
      keluar: t[4].innerText.trim(),
      keterangan: t[5].innerText.trim()
    });
  });
  return out;
}

// ---------------- SAVE ----------------
function simpan(){
  const payload = {
    nama: nama,
    catatan: JSON.stringify(readRows())
  };

  const body = Object.entries(payload)
      .map(([k,v]) => `${encodeURIComponent(k)}=${encodeURIComponent(v)}`)
      .join("&");

  fetch(APP_URL,{
    method:"POST",
    headers:{ "Content-Type":"application/x-www-form-urlencoded" },
    body
  }).then(r=>r.text())
    .then(()=> alert("Tersimpan"))
    .catch(()=> alert("Gagal simpan"));
}

// ---------------- LOAD ----------------
function loadData(){
  fetch(APP_URL+"?nama="+encodeURIComponent(nama))
    .then(r=>r.text())
    .then(txt=>{
      if(!txt.trim()){ renderEmpty(1); return; }

      let data;
      try{ data = JSON.parse(txt); }
      catch{ renderEmpty(5); return; }

      const c = document.getElementById("rowsContainer");
      c.innerHTML="";

      data.forEach((row,i)=>{
        c.appendChild(buatBaris(i+1,{
          no: row.no,
          catatan: row.catatan || "",
          jenis: row.jenis || "",
          mulai: row.mulai || "",
          keluar: row.keluar || "",
          keterangan: row.keterangan || ""
        }));
      });
    })
    .catch(()=> renderEmpty(5));
}

loadData();
</script>

</body>
</html>
