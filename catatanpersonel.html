<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Catatan Personel</title>

<style>
    body {
        background-color: black;
        color: #00ff00;
        font-family: "Courier New", monospace;
        padding: 20px;
        font-size: 14px;
    }

    textarea {
        width: 100%;
        height: 300px;
        background-color: black;
        color: #00ff00;
        border: 1px solid #00ff00;
        padding: 10px;
        resize: vertical;
        font-family: "Courier New", monospace;
        font-size: 12px;
    }

    button {
        background-color: black;
        color: #00ff00;
        border: 1px solid #00ff00;
        padding: 10px 20px;
        font-family: "Courier New", monospace;
        cursor: pointer;
        margin-top: 10px;
    }

    button:hover {
        background-color: #003300;
    }

    h2 {
        color: #00ff00;
        white-space: pre-line; /* penting agar nama muncul di baris bawah */
    }
</style>

<script>
let namaPersonel = "";

// ------------------------------
// 1. Ambil nama dari URL
// ------------------------------
function getNamaFromURL() {
    const params = new URLSearchParams(window.location.search);
    return params.get("nama") || "";
}

// ------------------------------
// 2. Load catatan dari Web App
// ------------------------------
function loadCatatan() {
    namaPersonel = getNamaFromURL();

    // tampilkan header CATATAN + nama di bawahnya
    const judulText =
        "CATATAN:\n" +
        namaPersonel;

    document.getElementById("judul").innerText = judulText;

    // ambil isi catatan dari Apps Script
    fetch("https://script.google.com/macros/s/AKfycbztqChoA2m81ag7O5dET4wOhyVwmvA94lGNfgQGAK3KtNMwSLLigCYkYfUdEzXdK5Xf/exec?nama=" + encodeURIComponent(namaPersonel))
        .then(res => res.text())
        .then(text => {
            document.getElementById("catatan").value = text;
        })
        .catch(err => {
            alert("Gagal mengambil catatan.");
            console.log(err);
        });
}

// ------------------------------
// 3. Simpan catatan ke Web App
// ------------------------------
function simpanCatatan() {
    const isi = document.getElementById("catatan").value;

    fetch("https://script.google.com/macros/s/AKfycbztqChoA2m81ag7O5dET4wOhyVwmvA94lGNfgQGAK3KtNMwSLLigCYkYfUdEzXdK5Xf/exec", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body:
            "nama=" + encodeURIComponent(namaPersonel) +
            "&catatan=" + encodeURIComponent(isi)
    })
    .then(res => res.text())
    .then(msg => {
        alert("Catatan berhasil disimpan!");
    })
    .catch(err => {
        alert("Gagal menyimpan.");
        console.log(err);
    });
}
</script>

</head>

<body onload="loadCatatan()">

<h2 id="judul"></h2>

<textarea id="catatan" placeholder="Tulis catatan personel di sini..."></textarea>

<br>

<button onclick="simpanCatatan()">SIMPAN</button>
<button onclick="history.back()">KEMBALI</button>

</body>
</html>
